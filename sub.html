<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>audio-visual learning</title>
    <link rel="stylesheet" href="plugin/bootstrap-5.2.0-dist/css/bootstrap.css">
    <link rel="stylesheet" href="style/jquery-rvnm.css">
    <style>
        header {
            background: transparent;
            box-shadow: 5px 5px 10px #cccccc47;
            -webkit-transition: background 0.5s ease-in-out, padding 0.5s ease-in-out;
            transition: background 0.5s ease-in-out, padding 0.5s ease-in-out;
        }

        header a {
            color: #000000 !important;
        }

        header.text-bg-light {
            /* header color */
            background-color: #ffc107 !important;
        }

        .toc {
            color: #ffc107 !important;
        }

        header.text-bg-light a {
            color: white !important;
        }

        header.text-bg-light .dropdown-menu a {
            color: #000000 !important;
        }

        .side-bar {
            margin-top: 0 !important;
            text-align: center;
        }


        .text li {
            margin: 20px 0;
        }

        .offcanvas-body li {
            margin: 5px 0;
        }

        a {
            word-break: break-word;
        }

        .menu-item {
            display: table !important;
            text-align: center;
            width: 100%;
            word-break: break-word;
        }

        .to-menu-item {
            -webkit-transition: all 0.1s ease-in-out;
            transition: all 0.1s ease-in-out;
        }

        .to-menu-item:hover {
            box-shadow: 0 0 10px #646464;
            width: 102% !important;
            position: relative;
            left: -1%;
            border-radius: 10px;
        }

        .right-content a {
            cursor: pointer;
        }

        .right-content.text video, .right-content.text img {
            width: 100%;
            max-width: 800px;
        }

        .level-two-toc-text{
            color: black !important;
            font-weight: 900 !important;
        }

    </style>
</head>
<body>

<header class="p-3 sticky-top scrolling-navbar">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="https://gewu-lab.github.io/" target="_blank"
               class="d-flex align-items-center mb-2 mb-lg-0 text-decoration-none"
               style="">
                <img src="img/logo.png" alt="logo" style="width: 40px; height: 40px;border-radius: 50%">
            </a>

            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0"
                style="padding-left: 30px">
                <li><a href="index.html" class="nav-link px-2 ">Overview</a></li>
                <li><a href="#" class="nav-link px-2 ">Full Survey</a></li>
                <li class="nav-item dropdown" style="z-index: 99999">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                       aria-expanded="false">
                        Content
                    </a>
                    <ul class="dropdown-menu" id="content-page-nav">
                        <li>
                            <a class="dropdown-item" href="sub.html?name=Audio-visual Boosting">
                                Audio-visual Boosting
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="sub.html?name=Cross-modal Perception">Cross-modal
                            Perception</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item" href="sub.html?name=Audio-visual Collaboration">
                                Audio-visual Collaboration
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a href="https://gewu-lab.github.io/awesome-audiovisual-learning/" class="nav-link px-2">Github</a>
                </li>
            </ul>

        </div>
    </div>
</header>


<nav id="item_menu" class="rvnm-navbar-box dark-doder sticky-top" style="box-shadow: 5px 5px 10px #cccccc47;">
    <ul>

        <li>
            <span class="spliter menu-item toc" style="font-size: 28px;font-weight: 900"><i
                    class="fa fa-cart-plus"></i>TOC</span>
        </li>
        <!--                    <li class="rvnm-expandable">-->
        <!--                        <a href="#">-->
        <!--                            <i class="fa fa-plus-square"></i> Nunc eleifend molestie velit. Morbi lobortis quam eu velit-->
        <!--                        </a>-->
        <!--                        <ul>-->
        <!--                            <li>-->
        <!--                                <a href="#">-->
        <!--                                    semper leo-->
        <!--                                </a>-->
        <!--                            </li>-->
        <!--                        </ul>-->
        <!--                    </li>-->

    </ul>

</nav>

<div style="padding: 16px 0;width: 100%;margin: auto">
    <div style="background-color: white;border-radius: 10px;margin-left: 220px">
        <div class="right-content img" style="height: calc(100vh);text-align: center">
            <div id="first-img">
                <!--                <img style="width: 100%;max-width: 1250px;margin: auto" alt="" src=""/>-->
            </div>
            <div id="menu-image"
                 style="display: flex;flex-wrap: wrap;width: 100%;max-width: 1200px;margin: 50px auto;overflow: hidden;">

            </div>

        </div>
        <div class="right-content text" style="display: none; padding: 30px 50px;border-radius: 10px;"></div>
    </div>
</div>

<div class=" offcanvas offcanvas-bottom" tabindex="-1" id="offcanvas-ref" aria-labelledby="offcanvas-ref-label">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">References</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body small">

    </div>
</div>

<script src="script/jquery-3.6.0.min.js"></script>
<script src="plugin/popper.min.js"></script>
<script src="plugin/bootstrap-5.2.0-dist/js/bootstrap.js"></script>
<script src="script/jquery-rvnm.js"></script>
<script src="script/marked.min.js"></script>

<script type="application/javascript">
    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    })(jQuery);

    function file_name_helper(name, fix) {
        if (typeof name === "undefined") {
            fix = "";
        }
        return name.replaceAll("/", " and ") + fix;
    }

    const re = /\[((\d+),?)+]/g
    $(function () {
        $("header").addClass("text-bg-light");
        // $(document)
        //     .off("scroll")
        //     .on("scroll", function () {
        //         const top = $(this).scrollTop();
        //         // header变色
        //         if (top > 50) {
        //             $("header").addClass("text-bg-light");
        //         } else {
        //             $("header").removeClass("text-bg-light");
        //         }
        //     });


        const page = {
            "Audio-visual Boosting": [
                "#Audio-visual Recognition",
                [
                    "!Speech Recognition",
                    "!Speaker Recognition",
                    "!Action Recognition",
                    "!Emotion Recognition",
                ],
                "#Uni-modal Enhancement",
                [
                    "!Speech Enhancement/Separation",
                    "!Object Sound Separation",
                    "!Face Super-resolution/Reconstruction",
                ]
            ],
            "Cross-modal Perception": [
                "#Cross-modal Generation",
                [
                    "!Mono Sound Generation",
                    "!Spatial Sound Generation",
                    "!Video Generation",
                    "!Depth Estimation",
                ],
                "!Audio-visual Transfer Learning",
                "!Cross-modal Retrieval",
            ],
            "Audio-visual Collaboration": [
                "Audio-visual Representation Learning",
                "#Audio-visual Localization",
                [
                    "!Sound Localization in Videos",
                    "!Audio-visual Saliency Detection",
                    "!Audio-visual Navigation",
                ],
                "!Audio-visual Event Localization/Parsing",
                "!Audio-visual Question Answering/Dialog",
            ],

        };


        const $menu_image = $("#menu-image");

        const colors = ["#0450b4", "#c2031a", "#03c2b2", "#ba4702",]
        const page_name = $.getUrlParam('name');
        const item_arr = page[page_name];
        let $append = $("#item_menu ul");
        for (let i = 0; i < item_arr.length; i++) {
            const color = colors[i % colors.length];
            let item = item_arr[i];
            if (!(item instanceof Array)) {
                if (item.startsWith("#")) {
                    let $dom = $('<div class="level-two-toc-text" style="margin: 20px 0 0 0;text-align: center;"><i class="fa fa-bullhorn"></i></div>');
                    $dom.text(item.substr(1));
                    $append.append($dom);
                    continue;
                }
                item = [item];
            }
            let $dom = null;
            for (let text of item) {
                if (text.startsWith("!")) {
                    text = text.substr(1);
                    let append = true;
                    const $div = $("<div style='width: 50%;margin 5px;'></div>");
                    const $img = $("<img class='to-menu-item' alt='" + text + "' src='' style='width: 100%;cursor: pointer;'/>");
                    $img.attr('value', text);
                    $img.data("name", text);
                    $img.attr("src", "content/" + page_name + "/" + file_name_helper(text, ".jpg"));

                    //特殊处理
                    if ("Speech Enhancement/Separation" === text) {
                        $div.css("width", "100%");
                    }
                    if ("Audio-visual Saliency Detection" === text) {
                        append = false;
                        $('img[value="Sound Localization in Videos"]').parent().append($img);

                    }
                    if (append) {
                        $menu_image.append($div.append($img));
                    }
                }

                $dom = $('<li class=""><a class="menu-item"> <i class="fa fa-bullhorn"></i></a></li>');
                let $dom_a = $dom.find(".menu-item");

                $dom_a.css('color', color);
                $dom_a.text(text);
                $dom_a.attr('value', text);
                $dom_a.data("name", text);

                if(item.length === 1){
                    $dom_a.addClass("level-two-toc-text");
                }

                $append.append($dom);

            }
            if ($dom !== null && i !== item_arr.length - 1) {
                $dom.append("<hr style='margin: 0;height: 2px;background: black;'>")
            }
        }
        $("#item_menu").rvnm();

        $(".right-content.img #first-img img").attr("src", "content/" + page_name + "/image.jpg");
        $(".title .lead").text(page_name)
        $("title").text(page_name)

        refs = {};

        $(document)
            .off("click", ".to-menu-item")
            .on("click", ".to-menu-item", function () {
                const $this = $(this);
                $('.menu-item[value="' + $this.data("name") + '"]').trigger('click');
            })
            .off("click", ".menu-item")
            .on("click", ".menu-item", function () {
                const $this = $(this);
                const name = $this.data("name");
                if (typeof (name) === "undefined" || name === "") {
                    $(".right-content.text").hide();
                    $(".right-content.img").show();
                    return;
                }
                let file_name = file_name_helper(name, ".md");
                $.get("content/" + page_name + "/" + file_name, function (data) {
                    const $append = $("<div></div>")
                    $append.append('<h1 style="margin-bottom: 60px">' + name + '</h1>')
                    console.debug(data)

                    const split = data.split("\n");
                    for (let line of split) {
                        line = line.trim();
                        if (line.length === 0) {
                            continue;
                        }

                        if (line.startsWith("- ") || line.startsWith("## ")) {
                            let $dom = $("<li></li>");

                            $dom.html(line.replaceAll(/(\[(((\d+),?)+)])/g, "<a class='ref'>$1</a>").substr(2));
                            $append.append($dom);
                            continue;
                        }

                        if (line.startsWith("# ")) {
                            $append.append($("<h3></h3>").text(line.substr(1)));
                            continue;
                        }

                        let match = line.match(/^\[(\d+)]/)
                        if (match !== null) {
                            let num = match[1];
                            refs[num] = line;
                            continue;
                        }
                        let html = marked.parse(line);
                        let $dom = $(html);
                        let $img = $dom.find("img");
                        $img.each(function () {
                            const $item = $(this);
                            if ($item.attr("src").endsWith(".mp4")) {
                                let $video = $("<video controls>");
                                $video.attr("src", $item.attr("src"));
                                $video.attr("alt", $item.attr("alt"));
                                $item.replaceWith($video);
                            }
                        })

                        $append.append($dom)
                    }

                    $(".right-content.text").html($append)
                }).fail(function (data) {
                    $(".right-content.text").html("<div class=\"alert alert-danger\" role=\"alert\">\n" +
                        "error: " + data.status +
                        "</div>")
                })


                $(".right-content.img").hide();
                $(".right-content.text").show();
                console.log(name)

            })
            .off("click", ".ref")
            .on("click", ".ref", function () {
                const $this = $(this);
                const text = $this.text();
                const ref_nums = text.substr(1, text.length - 2).split(",");
                const $offcanvas_ref = $("#offcanvas-ref");
                const $dom = $("<ul></ul>");
                for (const item of ref_nums) {
                    $dom.append("<li>" + refs[item].replaceAll(/\((.*?)\)/g, "(<a href='$1' target='_blank'>$1</a>)") + "</li>")
                }
                $offcanvas_ref.find(".offcanvas-body").html($dom);
                $offcanvas_ref.offcanvas("show");
                console.log(ref_nums)
            });
        $(function () {
            $('.menu-item[value="' + unescape(window.location.hash).substr(1) + '"]').trigger('click');
        })
    });
</script>
</body>
</html>