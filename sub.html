<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio-visual Learning</title>
    <link rel="stylesheet" href="plugin/bootstrap-5.2.0-dist/css/bootstrap.css">
    <style>
        .custom-popover {
            --bs-popover-min-width: 600px;
            --bs-popover-width: 600px;
            --bs-popover-border-color: var(--bs-primary);
            --bs-popover-header-bg: var(--bs-primary);
            --bs-popover-header-color: var(--bs-white);
            --bs-popover-body-padding-x: 1rem;
            --bs-popover-body-padding-y: .5rem;
        }

        .side-bar {
            margin-top: 0 !important;
            text-align: center;
        }


        .text li {
            margin: 20px 0;
        }

        .offcanvas-body li {
            margin: 5px 0;
        }

        a {
            word-break: break-all;
        }
    </style>
</head>
<body>

<div class="title" style="text-align: center;background-color: #ccc">
    <div class="my-3 py-3">
        <h2 class="display-5">Audio-visual Learning</h2>
        <p class="lead">this is a subtitle.</p>
    </div>
</div>
<div class="container" style=";padding-right:20px">

    <div class="row g-3">
        <div class="col-md-4 col-lg-3 side-bar">
            <div id="item_menu" class="sticky-top btn-group-vertical" role="group"
                 aria-label="Vertical radio toggle button group"
                 style="line-height: 100px;background-color:#fff;width: 100%;border-radius: 10px">
            </div>
        </div>
        <div class="col-md-9 col-lg-9"
             style="background-color: white;margin-top:0;border-radius: 10px;min-height: calc(100vh)">
            <div class="right-content img">
                <img style="width: 100%" alt="" src=""/>
            </div>
            <div class="right-content text" style="display: none; padding: 10px 20px;border-radius: 10px;"></div>
        </div>
    </div>
</div>

<div class=" offcanvas offcanvas-bottom" tabindex="-1" id="offcanvas-ref" aria-labelledby="offcanvas-ref-label">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">References</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body small">

    </div>
</div>

<script src="script/jquery-3.6.0.min.js"></script>
<!--<script src="plugin/popper.min.js"></script>-->
<script src="plugin/bootstrap-5.2.0-dist/js/bootstrap.js"></script>

<script type="application/javascript">
    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    })(jQuery);
    var re = /\[((\d+),?)+]/g
    $(function () {
        const page = {
            "Boosting Single Modality Learning": [
                [
                    "Speech Recognition",
                    "Speaker Recognition",
                    "Action Recognition",
                    "Emotion Recognition",
                ],
                [
                    "Speech Enhancement and Separation",
                    "Object Sound Separation",
                    "Face Super-resolution and Reconstruction",
                ]
            ],
            "Cross-modal Perception": [
                [
                    "Mono Sound Generation",
                    "Spatial Sound Generation",
                    "Video Generation",
                    "Depth Estimation",
                ],
                "Audio-visual Transfer Learning",
                "Cross-modal Retrieval",
            ],
            "Audio-visual Collaborative Learning": [
                [
                    "Audio-visual Consistency",
                    "Deep Clustering",
                    "Pre-training Models",
                ],

                [
                    "Sound Localization in Videos",
                    "Audio-visual Saliency Detection",
                    "Audio-visual Navigation",
                ],
                "Audio-visual Event Localization and Parsing",
                "Audio-visual Question Answering and Dialog",
            ],

        };
        const colors = ["#286da8", "#cd5360", "#b37d4e", "#438496",]
        const page_name = $.getUrlParam('name');
        const item_arr = page[page_name];
        let $append = $("#item_menu");
        let id_index = 0;
        for (let i = 0; i < item_arr.length; i++) {
            const color = colors[i % colors.length];
            let item = item_arr[i];
            if (!(item instanceof Array)) {
                item = [item];
            }
            for (const text of item) {
                let $dom_radio = $("<input type=\"radio\" class=\"btn-check\" name=\"vbtn-radio\" autocomplete=\"off\">")
                let $dom_label = $("<label class=\"btn \" style=';text-decoration: underline;text-align: left;margin: 1px auto; color: " + color + "'></label>")
                let id = "vbtn-radio" + id_index++;
                $dom_radio.attr("id", id);
                $dom_label.attr("for", id);
                $dom_label.text(text);
                $dom_label.data("name", text);

                $append.append($dom_radio);
                $append.append($dom_label);
            }

        }

        $(".right-content.img img").attr("src", "content/" + page_name + "/image.jpg");
        $(".title .lead").text(page_name)
        $("title").text(page_name)

        refs = {};

        $(document)
            .on("change", ".btn-check", function () {
                const $this = $(this);
                const name = $this.next().data("name");
                $.get("content/" + page_name + "/" + name + ".txt", function (data) {
                    const $append = $("<div></div>")
                    const split = data.split("\n");
                    console.debug(data)
                    for (let line of split) {
                        if (line.startsWith("##")) {
                            let $dom = $("<li></li>");

                            $dom.html(line.replaceAll(/(\[(((\d+),?)+)])/g, "<a class='ref'>$1</a>").substr(2));
                            $append.append($dom);
                        } else if (line.startsWith("#")) {
                            $append.append($("<h2></h2>").text(line.substr(1)));
                        } else if (line.startsWith("[")) {
                            let num = line.match(/^\[(\d+)]/)[1];
                            refs[num] = line;
                        }
                    }
                    $(".right-content.text").html($append)
                }).fail(function (data) {
                    $(".right-content.text").html("<div class=\"alert alert-danger\" role=\"alert\">\n" +
                        "error: " + data.status +
                        "</div>")
                })


                $(".right-content.img").hide();
                $(".right-content.text").show();
                console.log(name)

            })
            .on("click", ".ref", function () {
                const $this = $(this);
                const text = $this.text();
                const ref_nums = text.substr(1, text.length - 2).split(",");
                const $offcanvas_ref = $("#offcanvas-ref");
                const $dom = $("<ul></ul>");
                for (const item of ref_nums) {
                    $dom.append("<li>" + refs[item].replaceAll(/\((.*?)\)/g, "(<a href='$1' target='_blank'>$1</a>)") + "</li>")
                }
                $offcanvas_ref.find(".offcanvas-body").html($dom);
                $offcanvas_ref.offcanvas("show");
                console.log(ref_nums)
            })
        ;
    });
</script>
</body>
</html>